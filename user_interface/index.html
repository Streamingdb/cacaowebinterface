<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<title>cacaoweb</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
	<link rel="stylesheet" href="css/general.css" type="text/css" media="screen">
	<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/gebbadcnkcgcfgpbmcdleckpejgopimf">
</head>
<body>

	<noscript><div class="warning">This page will NOT work because Javascript is not enabled</div></noscript>
	

	<div class="page_wrapper">
	
		
		<div id="head">
			<div id="toplogo" class="smalllogo hidden">
				<a href="http://www.cacaoweb.org/?noredirect=yes"><img src="img/logo.png" alt="cacaoweb"></a>
			</div>
			<div id="topsearchbox" class="topsearch hidden">
				<div class="input_wrapp">
					<input id="smallsearchbar" class="search_bar" name="search_bar" onkeypress="searchboxkeypress(event, this);" type="text" placeholder="" />
					<a class="search_submit" href="#" onclick="searchbuttonclick(event, this);">
						<img src="img/mag-glass.png" alt="Search">
					</a>
				</div>
			</div>
			<ul id="top-toolbar">
				<li id="auth-notification"></li>
				<li id="loginbutton"><a onclick="keepDropdownMenu(event, this)" class="outset"><span id="logintext"></span><span class="i"></span></a>
					<ul>
						<div class="loginarea">
						<form onsubmit="submitlogin(event)">
							<label for="login" id="loginlabel"></label>
							<input class="loginfield" id="logininput" name="login" type="text" />
							<label for="password" id="passwordlabel"></label>
							<input class="loginfield" id="passwordinput" name="password" type="password" />
							<div class="loginbuttons">
								<input type="submit" name="submit" id="loginbtn" />
								<a id="registerbtn" href="javascript:register()"></a>
							</div>
						</form>
						</div>
					</ul>
				</li>
				<li><a href="admin.html" class="inset icon i-heart hidden"><span id="share"></span><span class="i"></span></a></li>
				<li><a id="mana" href="admin.html" class="inset icon i-config"><span class="i"></span></a></li>
				<li><a onclick="keepDropdownMenu(event, this)" class="outset icon i-dropdown"><span id="more"></span><span class="i"></span></a>
					<ul>
						<li><a href="http://forum.cacaoweb.org/" target="_newtab" id="helpmenu"></a></li>
						<li><a href="http://forum.cacaoweb.org/" target="_newtab" id="forummenu"></a></li>
						<li><a href="http://cacaoweb.org/?noredirect" target="_newtab" id="downloadmenu"></a></li>
						<li><a href="http://cacaoweb.org/?noredirect#dev" target="_newtab" id="devmenu"></a></li>
						<!-- <li><a href="http://cacaoweb.org/?noredirect#money" target="_newtab" id="moneymenu"></a></li> -->
					</ul>
				</li>
				
			</ul>
		</div>
		<!-- <div class="supportedplatforms">
			<small id="supportedplatforms">Supported platforms</small> 
			<ul>
				<li class="megavideoico" title="megavideo"></li>
				<li class="putlockerico" title="putlocker"></li>
				<li class="videobbico" title="videobb"></li>
				<li class="videozerico" title="videozer"></li>
				<li class="mixtureico" title="mixturevideo"></li>
			</ul>
		</div>-->
		<div id="content">
			<div id="warningarea" class="warning" style="display:none"></div>
			<div id="extensionarea" class="center bigger" style="display:none"><a href="javascript:chrome.webstore.install()" id="chromeextension"></a></div>
			<div id="mainsearch" class="center">
				<div class="logo">
					<a href="#"><img src="img/logo.png" alt="cacaoweb"></a>
				</div>
				<div class="mainpagesearchbar">
					<div class="input_wrapp">
						<input id="bigsearchbar" class="search_bar" onkeypress="searchboxkeypress(event, this);" autocomplete="off" type="text" />
						<a class="search_submit" href="#" onclick="searchbuttonclick(event, this);">
							<img src="img/mag-glass.png" alt="Search">
						</a>
					</div>
					<div id="searchhints" class="message"></div>
				</div>
			</div>
			<div id="searchresultsarea" style="display:none">
				<div id="didyoumean"></div>
				<div id="searchresults">
				</div>
			</div>
			<div id="linkarea" class="center" style="display:none">
			</div>
			<div id="playerarea" style="display:none">
				<div id="playerhead">
					<fieldset class="rating" onclick="ratefile(event, this)">
						<legend id="ratequality">Rate the quality of this video:</legend>
						<input type="radio" id="star5" name="rating" value="5" /><label for="star5" title="HD quality">5 stars</label>
						<input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="good quality">4 stars</label>
						<input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="decent">3 stars</label>
						<input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="watchable but very bad">2 stars</label>
						<input type="radio" id="star1" name="rating" value="1" /><label for="star1" title="not watchable">1 star</label>
					</fieldset>
					<div class="reportfake"><a id="reportfake" href="javascript:reportfake();">Not the right video? report as fake</a></div>
				</div>
				<div id="player">
				</div>
				<div id="sidebar">
					<div id="sidebar_inner">
					</div>
				</div>
			</div>
			<div id="recommend" class="center"></div>
			<div id="mostwatchedzone" class="center">
			</div>
		</div>
		<div id="msgSidebar">
			<header id="msgHeader">
				<h2>Send a <span class="withTxt">quick message</span> to your online friends</h2>
				<div id="msgSearchBox">
					<input name="" type="text" class="searchBox_bg" />
					<div class="btnSearchBox">
						<input type="submit" class="searchBox" />
					</div>
				</div>
			</header>
			<div id="capsules_area">
				<div class="capsule capGrey1 capNoMsg">
					<p><a href="#">User name</a></p>
				</div> 
				<div class="capsule capGrey1 capMsg">
					<p><a href="#">User name</a></p>
				</div> 
				<div class="capsule capGrey2 capMsg capexpand">
					<p><a href="#">User name</a></p>
					<div class="capTypeTxt">
						<textarea name="" cols="" rows=""></textarea>
						<div class="sendBtn">
							<input name="Send" type="button" value="Send">
						</div>
					</div>
				</div> 
				<div class="capsule capGrey1 capNoMsg">
					<p><a href="#">User name</a></p>
				</div> 
				<div class="capsule capGrey1 capMsg">
					<p><a href="#">User name</a></p>
				</div> 
				<div class="capsule capGrey2 capMsg capexpand">
					<p><a href="#">User name</a></p>
					<div class="capShowTxt">
						<p>Text for the friend´s message goes here.</p>
						<div class="sendBtn">
							<input name="Reply" type="button" value="Reply">
						</div>
					</div>
				</div> 
			</div> <!-- /#capsules_area --> 
			
		</div><!-- /#msgSidebar -->    

		<div class="footer_push"></div><!-- needed for sticky footer -->
		
	</div> <!-- end wrapper -->
	<div id="footer" class="footer"></div>
	<ul id="footercontent" class="footercontent center">
		<!-- not used anymore -->
	</ul>
	
	<script type="text/javascript">
	
		function includeScript(filename, scriptname) {
			var htmlDoc = document.getElementsByTagName('body').item(0);
			var scriptblock = document.getElementById(scriptname); 
			if (scriptblock) {
				htmlDoc.removeChild(scriptblock);
			}
			var script = document.createElement("script");
		
			script.id = scriptname;
			script.src = filename;
			script.type = 'text/javascript';
			htmlDoc.appendChild(script);
		}
		function escapestring(str) {
			if (str) {
				return str.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g,'\\$1')
			} else {
				return str;
			}
		}
		function readCookie(name) {
			var nameEQ = name + "=";
			var ca = document.cookie.split( ';');
			for( var i=0;i < ca.length;i++) {
				var c = ca[i];
				while ( c.charAt( 0)==' ') c = c.substring( 1,c.length);
				if ( c.indexOf( nameEQ) == 0) return c.substring( nameEQ.length,c.length);
			}
			return null;
		}
		
		
	
		/** language management 
		*/
		var lang;
		var nav_lang;
		
		nav_lang = navigator.userLanguage || navigator.language || 'en';

		lang = nav_lang.substring(0, 2);
		switch (lang) {
			case 'en':
				break;
			case 'fr':
				break;
			case 'it':
				break;
			case 'pl':
				break;
			case 'es':
				break;
			default:
				lang = 'en';
		}
		
		var cookielang = readCookie('cacaolang');
		if (cookielang != null) {
			lang = cookielang;
		}
		
		var searchlang = lang;
		
	</script>
	<script src="languagestrings.js" type="text/javascript"></script>
	<script type="text/javascript">	
		
		document.getElementById('mana').innerHTML = langstrings[lang]['management'] + '<span class="i"></span>';
		document.getElementById('searchhints').innerHTML = langstrings[lang]['searchhints'];
		//document.getElementsByTagName('title')[0].innerHTML = langstrings[lang]['cacaowebtitle'];
		document.getElementById('logintext').innerHTML = langstrings[lang]['login'];
		document.getElementById('loginlabel').innerHTML = langstrings[lang]['name'] + ':';
		document.getElementById('passwordlabel').innerHTML = langstrings[lang]['password'] + ':';
		document.getElementById('loginbtn').value = langstrings[lang]['login'].toLowerCase();
		document.getElementById('registerbtn').innerHTML = langstrings[lang]['register'];
		document.getElementById('share').innerHTML = langstrings[lang]['share'];
		document.getElementById('more').innerHTML = langstrings[lang]['more'];
		document.getElementById('helpmenu').innerHTML = langstrings[lang]['help'];
		document.getElementById('forummenu').innerHTML = langstrings[lang]['forum'];
		document.getElementById('downloadmenu').innerHTML = langstrings[lang]['download'];
		document.getElementById('devmenu').innerHTML = langstrings[lang]['developers'];
		//document.getElementById('moneymenu').innerHTML = langstrings[lang]['makemoney'];
		//document.getElementById('supportedplatforms').innerHTML = langstrings[lang]['supportedplatforms'];
		document.getElementById('ratequality').innerHTML = langstrings[lang]['ratequality'];
		document.getElementById('reportfake').innerHTML = langstrings[lang]['reportfake'];
		document.getElementById('chromeextension').innerHTML = langstrings[lang]['chromeextension'];
		document.getElementById('smallsearchbar').setAttribute('placeholder', langstrings[lang]['searchplaceholder']);
	
		if (lang == 'it') {
			document.getElementById('recommend').innerHTML = 'Per la miglior fonte di video in Italia, vai su <a href="http://papystreaming.com/it" target="_blank">papystreaming</a>';
		} else if (lang == 'fr') {
			document.getElementById('recommend').innerHTML = 'Pour regarder tous vos films et séries sans limites, allez sur <a href="http://papystreaming.com/fr" target="_blank">papystreaming</a>';
		} else if (lang == 'es') {
			document.getElementById('recommend').innerHTML = 'Para ver todas tus películas y series de televisión, ir a <a href="http://papystreaming.com/es" target="_blank">papystreaming</a>';
		}
		
		var currentsearchpos = 0;
		var currentsearchterm = '';
		var currentfileid = '';
		var username = '';
		var updateWarningsInterval = 20.0;
		
		
		
		function toggle(elt) {
			if (elt.style.display == "none") {
				elt.style.display = "block";
			} else {
				elt.style.display = "none";
			}
		}
		
		function reportfake() {
			includeScript('http://user.cacaoweb.org/fakereport.php?fileid=' + currentfileid + "&username=" + encodeURIComponent(username), "fakereportscript");
			alert("this fake file was reported successfully");
		}
		function ratefile(e, o) {
			var field;
			for (var y = 0; y < o.childNodes.length; y++) {  
				field = o.childNodes[y];
				if (field.checked) {
					includeScript('http://user.cacaoweb.org/ratefile.php?fileid=' + currentfileid + "&username=" + encodeURIComponent(username) + "&rating=" + field.value, "ratingscript");
				}
			}  
		}
		
		
		function callbackWarnings(result) {
			var warnings = document.getElementById('warningarea');
			if (result == 'outdated') {
				warnings.innerHTML = langstrings[lang]['outdated'];
			} else if (result == 'noudp') {
				warnings.innerHTML = langstrings[lang]['noconnectivity'];
			} else if (result == 'permissionproblem') {
				warnings.innerHTML = langstrings[lang]['permissionproblem'];
			} else if (result == 'nospaceleft') {
				warnings.innerHTML = langstrings[lang]['nospaceleft'];
			} else if (result == 'badrouter') {
				warnings.innerHTML = langstrings[lang]['natnotp2pfriendly'];
			} 
		}
		function updateWarnings() {
			var i = Math.floor(Math.random() * 1000000);
			includeScript('http://127.0.0.1:4001/errors?unique=' + i, 'warningsscript');
		}
		
		setInterval("updateWarnings()", updateWarningsInterval * 1000);		
		updateWarnings();
		
		function clearsearch() {
		}
		/** sets the page in play mode */
		function playmode() {
			if (document.getElementById('warningarea').innerHTML != "") {
				document.getElementById('warningarea').style.display = "block";
			}
		
			document.getElementById('toplogo').style.display = "block";
			document.getElementById('topsearchbox').style.display = "block";
			document.getElementById('mainsearch').style.display = "none";
			document.getElementById('footercontent').style.display = "none";
			
			document.getElementById('searchresultsarea').style.display = "none";
			document.getElementById('searchresults').innerHTML = "";
			
			document.getElementById('linkarea').style.display = "none";
			
			document.getElementById('mostwatchedzone').style.display = "none";
		}
		/** sets the page in search results mode */
		function searchmode() {
			document.getElementById('warningarea').style.display = "none";
		
			document.getElementById('toplogo').style.display = "block";
			document.getElementById('topsearchbox').style.display = "block";
			document.getElementById('mainsearch').style.display = "none";
			document.getElementById('footer').style.display = "none";
			document.getElementById('footercontent').style.display = "none";
			
			document.getElementById('searchresultsarea').style.display = "block";
			document.getElementById('searchresults').innerHTML = "";
			
			document.getElementById('linkarea').style.display = "none";
			
			document.getElementById('mostwatchedzone').style.display = "none";
			
			document.getElementById('smallsearchbar').focus();
		}
		function linkmode() {
			document.getElementById('warningarea').style.display = "none";
		
			document.getElementById('toplogo').style.display = "block";
			document.getElementById('topsearchbox').style.display = "block";
			document.getElementById('mainsearch').style.display = "none";
			document.getElementById('footer').style.display = "none";
			document.getElementById('footercontent').style.display = "none";
			
			document.getElementById('searchresultsarea').style.display = "none";
			document.getElementById('searchresults').innerHTML = "";
		
			document.getElementById('linkarea').style.display = "block";
			
			document.getElementById('mostwatchedzone').style.display = "none";
		}
			
		function processrelatedresults(results) {
			var elt = document.getElementById('sidebar_inner');
			elt.innerHTML = "";
			var header = document.createElement('h1');
			header.innerHTML = langstrings[lang]['youmightlike'];
			elt.appendChild(header);
			for (var i = 0; i < results.length; i++) {
				var title = results[i].title;
				var entry = document.createElement('li');
				entry.innerHTML = '<a href="javascript:search(\'' + escapestring(title) + '\')">' + title + '</a>';
				elt.appendChild(entry);
			}
		}
		
		function play(link) {
			playmode();
			
			var playerobj = '<object width="640" height="360"><param name="allowFullScreen" value="true" /><param name="flashvars" value="file=' + link + '" /><param name="wmode" value="direct" /><param name="movie" value="player.swf" /><embed src="player.swf" wmode="direct" flashvars="file=' + link + '" width="640" height="360" allowFullScreen="true" type="application/x-shockwave-flash" /></object>';

			document.getElementById('player').innerHTML = playerobj;
			document.getElementById('playerarea').style.display = 'block';
			
			
			if (link.indexOf('127.0.0.1') > -1) { // condition pour savoir si c'est un lien cacaoweb
				var fileid = extractfileid(link);
				currentfileid = fileid;
				includeScript('http://search.cacaoweb.org/related?lang=' + lang + '&fileid=' + fileid, 'mostwatchedscript');
			}
		}
		
		/* parsesearchresults is called as a callback */
		function submitSearch(pos) {
			currentsearchpos = pos;
			includeScript('http://search.cacaoweb.org/search_v1?searchterm=' + encodeURIComponent(currentsearchterm.toLowerCase()) + '&lang=' + searchlang + '&pos=' + pos, 'searchscript');
		}
		
		function ismd5(s) {
			var ls = s.toUpperCase();
			if (ls.length == 32) {
				var c;
				for (var i = 0; i < 32; i++) {
					c = ls.charCodeAt(i);
					if (!((c >= 48 && c <= 57) || (c >= 65 && c <= 70))) {
						return false;
					}
				}
				return true;
			} else {
				return false;
			}
		}
		
		var parselinks = {			
			
			isMixturelink : function(link) {
				return ((link.indexOf("mixturecloud.com/") > -1 || link.indexOf("mixturevideo.com/") > -1) && (link.indexOf("video=") > -1 || link.indexOf("/video/") > -1 || link.indexOf("/media/") > -1));
			},
			getMixtureID : function(link) {
				var ff = link.split("video=");
				if (!ff[1]) {
					ff = link.split("/video/");
				}
				if (!ff[1]) {
					ff = link.split("/media/");
				}
				return ff[1];
			},
			
			isPutlockerlink : function(link) {
				return (link.indexOf("putlocker.com/") > -1 && link.indexOf("/file/") > -1);
			},
			getPutlockerID : function(link) {
				var ff = link.split("/file/");
				return ff[1];
			},
			
			isNowvideolink : function(link) {
				return (link.indexOf("nowvideo.") > -1 && link.indexOf("/video/") > -1);
			},
			getNowvideoID : function(link) {
				var ff = link.split("/video/");
				return ff[1];
			},
			
			isMoevideoslink : function(link) {
				return (link.indexOf("moevideo") > -1 && link.indexOf("/online/") > -1);
			},
			getMoevideosID : function(link) {
				var ff = link.split("/online/");
				return ff[1];
			},
		
		};
		
		function extractfileid(link) {
			var cacaohash = link;
			var pos1 = link.indexOf('f=');
			if (pos1 > -1) {
				cacaohash = link.substr(pos1 + 2);
			} else {
				var pos2 = link.lastIndexOf('/');
				if (pos2 > -1) {
					cacaolink = link.substr(pos2 + 1);
				}
			}
			return cacaohash;
		}
		
		function generateCacaoLink(searchitem) {
			var iscacaoid = ismd5(searchitem);
			if (searchitem.indexOf('http://') == -1 && !iscacaoid) { // search
				if (searchitem != "") {
					submitSearch(0);
				}
				return "";
			} else if (searchitem.indexOf('127.0.0.1') > -1 || searchitem.indexOf('localhost') > -1 || iscacaoid) { // cacao
				var cacaohash = extractfileid(searchitem);
				return ("http://127.0.0.1:4001/" + cacaohash);
			} else if (parselinks.isMixturelink(searchitem)) { 
				var videoid = parselinks.getMixtureID(searchitem);
				return ("http://127.0.0.1:4001/mixture/mixture.caml?videoid=" + videoid);
			} else if (parselinks.isPutlockerlink(searchitem)) { 
				var videoid = parselinks.getPutlockerID(searchitem);
				return ("http://127.0.0.1:4001/putlocker/putlocker.caml?videoid=" + videoid);
			} else if (parselinks.isNowvideolink(searchitem)) { 
				var videoid = parselinks.getNowvideoID(searchitem);
				return ("http://127.0.0.1:4001/nowvideo/nowvideo.caml?videoid=" + videoid);
			} else if (parselinks.isMoevideoslink(searchitem)) { 
				var videoid = parselinks.getMoevideosID(searchitem);
				return ("http://127.0.0.1:4001/moevideos/moevideos.caml?videoid=" + videoid);
			} else if (searchitem.indexOf('megaupload.com/?d=') > -1) { // megaupload
				var pos1 = searchitem.indexOf('d=');
				var megauploadid = searchitem.substr(pos1 + 2, 8);
				return ("http://127.0.0.1:4001/megaupload/download.caml?downloadid=" + megauploadid);
			} else { // type inconnu
				return "unknown";
			}
		}
		
		function linkMetainfoCallback(issuccess, errormsgortitle, downloadlink) {
			if (issuccess == 1) {
				document.getElementById('linkarea').innerHTML = '<a href="' + downloadlink + '">' + langstrings[lang]['download'] + ' ' + errormsgortitle + '</a>';
				linkmode();
			} else {
				document.getElementById('linkarea').innerHTML = errormsgortitle;
				linkmode();
			}
		}
			
		function processUserEntry() {
			document.getElementById('playerarea').style.display = 'none';
			document.getElementById('didyoumean').innerHTML = "";
			var searchitem = currentsearchterm;
			var cacaolink = generateCacaoLink(searchitem);
			if (cacaolink != "unknown") {
				if (cacaolink != "") {
					/*if (cacaolink.indexOf("megaupload") > -1) {
						var pos1 = searchitem.indexOf('d=');
						var megauploadid = searchitem.substr(pos1 + 2, 8);
						includeScript('http://127.0.0.1:4001/meta/meta.caml?contentid=' + megauploadid + '&provider=megaupload', 'metainfolink');
					} else {*/
						play(cacaolink);
					//}
				}
			} else {
				alert(langstrings[lang]['linknotrecognized']);
				clearsearch();
				document.getElementById('searchhints').innerHTML = langstrings[lang]['typeoflinks'];
			}
		}
		
		function searchboxkeypress(oEvent, oInput) {
			var code;
			if (oInput.value == '') {
				return false;
			}
 
			if (oEvent && oEvent.which) {
				code = oEvent.which;
			} else {
				code = oEvent.keyCode;
			}
 
			if (code == 13) {
				currentsearchterm = oInput.value;
				processUserEntry();
				true;
			}
			return false;
		}
		function searchbuttonclick(e, o) {
			currentsearchterm = o.previousSibling.previousSibling.value;
			processUserEntry();
		}
		
		function togglesearchresultsseason(e, o) {
			var elts = o.parentNode.parentNode.childNodes;
			for (var i = 0; i < elts.length; i++) {
				if (elts[i].className == "seasonepisodes") {
					toggle(elts[i]);
				}
			}
		}
		function togglesearchresultsepisode(e, o) {
			var elts = o.parentNode.parentNode.childNodes;
			for (var i = 0; i < elts.length; i++) {
				if (elts[i].className == "episodelinks") {
					toggle(elts[i]);
				}
			}
		}
		
		function parsesearchresults(results) {
			document.getElementById('searchhints').innerHTML = langstrings[lang]['searchhints'];;
			searchmode();
			var searchresults = document.getElementById('searchresults');
			
			if (results == "" || (results.showsresults.length == 0 && results.moviesresults.length == 0)) {
				searchresults.innerHTML = langstrings[lang]['noresults'];
			}
			
			for (var i = 0; i < results.showsresults.length; i++) { 
				function buildepisodelink(episodelink) {
					var summary = '';
					if (episodelink.lang) {
						summary = langstrings[lang][episodelink.lang];
					}
					if (episodelink.subs) {
						summary = summary + ', ' + langstrings[lang]['subtitles'] + ' ' + langstrings[lang][episodelink.subs];
					}
					if (summary != "") {
						summary = " - (" + summary + ")";
					}
					var ratingstars = '';
					if (episodelink.rating) {
						ratingstars = '<div class="stars">';
						var n = Math.round(episodelink.rating);
						for (var j = 0; j < n; j++) {
							ratingstars += '&#9733 ';
						}
						ratingstars += '</div>';
					}
					return ('<div class="episodelink"><a href="javascript:play(\'' + episodelink.link + '\')">' + langstrings[lang]['playvideolink'] + '</a> ' + summary + ratingstars + '</div>');
				}
				function buildepisode(episode) {
					var episodelinks = '';
					for (var j = 0; j < episode.episodelinks.length; j++) {
						episodelinks = episodelinks + buildepisodelink(episode.episodelinks[j]);
					}
					return ('<div class="episoderesult searchheader"><div class="episodenumber"><a href="#" onclick="togglesearchresultsepisode(event, this)">' + langstrings[lang]['episode'] + ' ' + episode.episode + '</a></div><div class="episodelinks" style="display:none">' + episodelinks + '</div></div>');
				}
				function buildseason(season) {
					var episodes = '';
					for (var j = season.episodes.length - 1; j >= 0; j--) {
						episodes = episodes + buildepisode(season.episodes[j]);
					}
					if (season.season == -1) {
						return '<div class="seasonepisodes">' + episodes + '</div>';
					} else {
						return ('<div class="seasonresult searchheader"><div class="seasonnumber"><a href="#" onclick="togglesearchresultsseason(event, this)">' + langstrings[lang]['season'] + ' ' + season.season + '</a></div><div class="seasonepisodes" style="display:none">' + episodes + '</div></div>');
					}
				}
				function buildtvshow(tvshow) {
					var seasons = '';
					for (var j = tvshow.seasons.length - 1; j >= 0; j--) {
						seasons = seasons + buildseason(tvshow.seasons[j]);
					}
					return ('<div class="searchshowtitle">' + tvshow.showtitle + '</div><div class="seasonsresults">' + seasons + '</div>');
				}
				
				var show = results.showsresults[i];
				var entry;
				entry = document.createElement('div');
				entry.setAttribute('class', "tvshowsearchentry");
				entry.innerHTML = buildtvshow(results.showsresults[i]);
				searchresults.appendChild(entry);
			} 
			for (var i = 0; i < results.moviesresults.length; i++) { 
				var movie = results.moviesresults[i];
				var entry;
				entry = document.createElement('div');
				entry.setAttribute('class', "searchentry");
				var summary = movie.moviename;
				if (movie.lang) {
					summary = summary + ' ' + langstrings[lang][movie.lang];
				}
				if (movie.subs) {
					summary = summary + ' ' + langstrings[lang]['subtitles'] + ': ' + langstrings[lang][movie.subs];
				}
				var ratingstars = '';
				if (movie.rating) {
					ratingstars = '<div class="stars">';
					var n = Math.round(movie.rating);
					for (var j = 0; j < n; j++) {
						ratingstars += '&#9733 ';
					}
					ratingstars += '</div>';
				}
				entry.innerHTML = '<div class="searchheader"><a href="javascript:play(\'' + movie.link + '\')">' + movie.moviename + '</a>' + ratingstars + '</div><div class="searchsummary">' + summary + '</div><div class="searchlink" style="display:none">' + movie.link + '</div><div class="searchshowlink"><a href="#" onclick="showlink(event, this)">' + langstrings[lang]['showlink'] + '</a></div>';
				searchresults.appendChild(entry);
			} 
			if (results.didyoumeanresults.length > 0) { document.getElementById('didyoumean').innerHTML = '<p>' + langstrings[lang]['didyoumean'] + '</p>'; }
			for (var i = 0; i < results.didyoumeanresults.length; i++) { 
				var search = results.didyoumeanresults[i];
				document.getElementById('didyoumean').innerHTML = document.getElementById('didyoumean').innerHTML + '<a href="javascript:search(\'' + escapestring(search) + '\')">' + search + '</a>, ';
			} 
		}
		function search(searchterm) {
			currentsearchterm = searchterm;
			document.getElementById('didyoumean').innerHTML = "";
			document.getElementById('searchresults').innerHTML = "";
			processUserEntry();
		}
		
		function showlink(e, o) {
			o.parentNode.previousSibling.style.display = "";
			o.parentNode.style.display = "none";
		}
		
		/** toggles the drop down menu when the user clicks on the button */
		function keepDropdownMenu(e, o) {
			var menu = o.parentNode.getElementsByTagName('ul')[0];
			if (menu.style.display == 'block') {
				menu.style.display = "none";
			} else {
				menu.style.display = "block";
			}
		}
				
				
		/** featured content display */
		
		function processfeaturedresults(data) {
			for (var i = 0; i < data.showsresults.length; i++) { 
				var show = data.showsresults[i];
				var entry1 = document.createElement('li');
				entry1.innerHTML = '<a href="javascript:play(\'' + show.link + '\')"><img src="' + show.imagelink + '" /><div>' + show.showtitle + ' S' + show.season + 'E' + show.episode + '</div></a>';
				document.getElementById('sidebar_inner').appendChild(entry1);
				var entry = document.createElement('li');
				entry.innerHTML = '<a href="javascript:play(\'' + show.link + '\')"><img src="' + show.imagelink + '" /><div>' + show.showtitle + ' S' + show.season + 'E' + show.episode + '</div></a>';
				document.getElementById('footercontent').appendChild(entry);
			} 
			for (var i = 0; i < data.moviesresults.length; i++) { 
				var movie = data.moviesresults[i];
				var entry = document.createElement('li');
				entry.innerHTML = '<a href="javascript:play(\'' + movie.link + '\')"><img src="' + movie.imagelink + '" /></a><div>' + movie.movietitle + '</div>';
				document.getElementById('sidebar_inner').appendChild(entry);
				var entry1 = document.createElement('li');
				entry1.innerHTML = '<a href="javascript:play(\'' + movie.link + '\')"><img src="' + movie.imagelink + '" /></a><div>' + movie.movietitle + '</div>';
				document.getElementById('footercontent').appendChild(entry1);
			} 
		}
		
		/** display the most watched */
		
		function processmostwatchedresults(results) {
			var elt = document.getElementById('mostwatchedzone');
			elt.innerHTML = "";
			var header = document.createElement('h1');
			header.innerHTML = langstrings[lang]['mostwatched'];
			var colgroup = document.createElement('div');
			colgroup.className = "center";
			colgroup.id = "columnsgroup";
			elt.appendChild(header);
			elt.appendChild(colgroup);
			var col1 = document.createElement('div');
			col1.className = "column";
			colgroup.appendChild(col1);
			var col2 = document.createElement('div');
			col2.className = "column";
			colgroup.appendChild(col2);
			for (var i = 0; i < Math.floor(results.length / 2); i++) {
				var title = results[i].title;
				var entry = document.createElement('li');
				entry.innerHTML = '<a href="javascript:search(\'' + escapestring(title) + '\')">' + title + '</a>';
				col1.appendChild(entry);
			}
			for (var i = Math.floor(results.length / 2); i < results.length; i++) {
				var title = results[i].title;
				var entry = document.createElement('li');
				entry.innerHTML = '<a href="javascript:search(\'' + escapestring(title) + '\')">' + title + '</a>';
				col2.appendChild(entry);
			}
		}
		
		
		/** displays the related contents */
		
		

		
		/** login and registration management */
		
				
		function logincallback(result) {
			if (result == 1) {
				includeScript('http://127.0.0.1:4001/isloggedin', 'isloggedinscript');
			} else {
				alert("username or password is wrong");
			}
		}
		function loginstatuscallback(result, user, token) {
			if (result) {
				username = user;
				document.getElementById('loginbutton').style.display = "none";
				document.getElementById('auth-notification').innerHTML = langstrings[lang]['welcome']  + user;
			} 
		}
		
		
		function stopEvent(e) {
			if (e.stopPropagation) e.stopPropagation();
			else e.cancelBubble = true;

			if (e.preventDefault) e.preventDefault();
			else e.returnValue = false;
		}
		function submitlogin(e) {
			stopEvent(e);
			var username = document.getElementById('logininput').value;
			var password = document.getElementById('passwordinput').value;
			includeScript('http://127.0.0.1:4001/login?username=' + encodeURIComponent(username) + "&password=" + encodeURIComponent(password), 'loginscript');
			return false;
		}
		
		function register() {
			window.open('admin.html?register', '_newtab')
		}
		
		
		
		/** initialisation, check the url to know whether some video has to be played */
		function init() {
			if (window.top !== window.self) window.top.location.replace(window.self.location.href);
			// check if the cacaoweb chrome extension is installed
			if (typeof chrome !== "undefined" && typeof chrome.app !== "undefined") {
				var extensionmarker = document.getElementById('cacaowebchromeextension'); 
				if (extensionmarker) {
					// extension is installed.
				} else {
					document.getElementById('extensionarea').style.display = "block";
					linkmode();
					return;
				}
			}
			//includeScript('http://search.cacaoweb.org/featured?lang=' + lang, 'featuredscript');
			var url = window.location.href;
			if (url.indexOf("videoid=") > -1) {
				/* we need to play a video straight away */
				var pos = url.indexOf("videoid=");
				var pos1 = url.indexOf("&", pos);
				if (pos1 > -1) {
					var videoid = url.substr(pos + 8, pos1 - pos - 8);
				} else {
					var videoid = url.substr(pos + 8);
				}
				var fullrequest = url.substr(pos + 8);
				if (url.indexOf("provider=mi") > -1) {
					play("http://127.0.0.1:4001/mixture/mixture.caml?videoid=" + videoid);
				} else if (url.indexOf("provider=pu") > -1) {
					play("http://127.0.0.1:4001/putlocker/putlocker.caml?videoid=" + videoid);
				} else if (url.indexOf("provider=nv") > -1) {
					play("http://127.0.0.1:4001/nowvideo/nowvideo.caml?videoid=" + videoid);
				} else if (url.indexOf("provider=mo") > -1) {
					play("http://127.0.0.1:4001/moevideos/moevideos.caml?videoid=" + videoid);
				} else if (url.indexOf("provider=mu") > -1) {
					//play("http://127.0.0.1:4001/videozer/videozer.caml?videoid=" + videoid);
					
				} else if (url.indexOf("provider=cacao") > -1 || ismd5(videoid)) {
					play("http://127.0.0.1:4001/?f=" + fullrequest);
				}
			} else {
				// shows the most searched
				includeScript('http://search.cacaoweb.org/mostwatched?lang=' + lang, 'mostwatchedscript');
			}
			
			
		}
		
		/* initialization  */
		setTimeout(function () { init() }, 500); // we wait to make sure the extension is installed

		/** callback is loginstatuscallback(isloggedin, username, token) */
		includeScript('http://127.0.0.1:4001/isloggedin', 'isloggedinscript');

		
		document.getElementById('bigsearchbar').focus();
		
		
	</script>
	
	
</body>
</html>